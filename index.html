
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Matt Command Center</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 1fr);
    height: 100vh;
    gap: 8px;
    padding: 8px;
  }

  .tile {
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
    padding: 10px;
    overflow: hidden;
  }

  .tile:hover {
    background: #222;
  }

  a {
    color: white;
    text-decoration: none;
    width: 100%;
    display: block;
  }

  .personal {
    background: #1a1a2e;
  }

  ul {
    margin: 4px 0 0 0;
    padding-left: 0;
    font-size: 0.9em;
    list-style: none;
    width: 100%;
  }

  li {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 6px;
  }

  input[type="text"] {
    flex: 1;
    padding: 4px 6px;
    font-size: 0.9em;
    border-radius: 4px;
    border: none;
  }

  button {
    padding: 4px 6px;
    font-size: 0.8em;
    margin-left: 6px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
  }

  /* Mobile adjustments */
@media (max-width: 768px) {

  .grid {
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }

  .tile {
  font-size: clamp(5rem, 15vw, 9rem);
}

  ul {
    font-size: 1.2em;   /* Bigger task text */
  }

  button {
    font-size: 1em;
  }

  input[type="text"] {
    font-size: 1.1em;
  }

}

</style>
</head>
<body>

<div class="grid">

  <!-- Work Tiles -->
  <div class="tile">
    <a href="https://outlook.office.com/mail/" target="_blank">Outlook</a>
  </div>

  <div class="tile">
    <a href="https://app.slack.com/" target="_blank">Slack</a>
  </div>

  <div class="tile">
    <a href="https://www.icloud.com/reminders/" target="_blank">Reminders</a>
  </div>

  <!-- Personal Tiles -->
  <div class="tile personal" id="google-tasks-tile" style="align-items:flex-start; justify-content:flex-start; padding:10px;">
    <!-- Header clickable only -->
    <a href="https://tasks.google.com/" target="_blank">
      <h2 style="margin:0; padding:0; line-height:1.2;">Google Tasks</h2>
    </a>
    <ul id="tasks-list"></ul>
  </div>

  <div class="tile personal">
    <a href="https://chat.openai.com/" target="_blank">ChatGPT</a>
  </div>

  <div class="tile personal">
    <a href="https://mattjin70.github.io/asl-study-hub/" target="_blank">ASL STUDY HUB</a>
  </div>

</div>

<!-- Google API for OAuth -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
const CLIENT_ID = '903590667874-gln8c4dq5m9if43o6879fqofqqh3smiu.apps.googleusercontent.com';
const SCOPES = 'https://www.googleapis.com/auth/tasks';
let tokenClient;
let oauthToken;

// Render Sign-In button first
function renderSignInButton() {
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML = '';
  const btn = document.createElement('button');
  btn.textContent = 'Sign in to load tasks';
  btn.onclick = handleAuth;
  tasksList.appendChild(btn);
}

// Handle OAuth sign-in
function handleAuth() {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    prompt: 'consent',
    callback: (resp) => {
      oauthToken = resp.access_token;
      loadTasks();
    }
  });
  tokenClient.requestAccessToken();
}

// Load tasks DIRECTLY from Google (NO WORKER)
async function loadTasks() {
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML = '';

  // Input for new task
  const inputLi = document.createElement('li');
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'New taskâ€¦';

  const addBtn = document.createElement('button');
  addBtn.textContent = 'Add';
  addBtn.onclick = async () => {
    if (!input.value.trim()) return;

    await fetch(
      'https://tasks.googleapis.com/tasks/v1/lists/@default/tasks',
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${oauthToken}`
        },
        body: JSON.stringify({ title: input.value })
      }
    );

    input.value = '';
    loadTasks();
  };

  inputLi.appendChild(input);
  inputLi.appendChild(addBtn);
  tasksList.appendChild(inputLi);

  // Fetch tasks
  const response = await fetch(
    'https://tasks.googleapis.com/tasks/v1/lists/@default/tasks',
    {
      headers: { 'Authorization': `Bearer ${oauthToken}` }
    }
  );

  if (!response.ok) {
    tasksList.innerHTML = '<li>Error loading tasks</li>';
    console.error(await response.text());
    return;
  }

  const data = await response.json();
  const tasks = (data.items || []).filter(task => task.status !== 'completed');

  if (tasks.length === 0) {
    const li = document.createElement('li');
    li.textContent = 'No active tasks ðŸŽ‰';
    tasksList.appendChild(li);
    return;
  }

  // Render tasks
  tasks.forEach(task => {
    const li = document.createElement('li');

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.onclick = async () => {

  // Remove from UI immediately
  li.remove();

  await fetch(
    `https://tasks.googleapis.com/tasks/v1/lists/@default/tasks/${task.id}`,
    {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${oauthToken}`
      },
      body: JSON.stringify({
        status: 'completed',
        completed: new Date().toISOString()
      })
    }
  );

};

    const span = document.createElement('span');
    span.textContent = task.title;
    span.style.marginLeft = '8px';

    const delBtn = document.createElement('button');
    delBtn.textContent = 'Delete';
    delBtn.onclick = async () => {
      await fetch(
        `https://tasks.googleapis.com/tasks/v1/lists/@default/tasks/${task.id}`,
        {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${oauthToken}`
          }
        }
      );
      loadTasks();
    };

    li.appendChild(checkbox);
    li.appendChild(span);
    li.appendChild(delBtn);
    tasksList.appendChild(li);
  });
}

// Initialize
window.onload = () => {

  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (resp) => {

      // If silent auth fails â†’ show button
      if (resp.error || !resp.access_token) {
        renderSignInButton();
        return;
      }

      oauthToken = resp.access_token;
      loadTasks();
    }
  });

  // Try silent sign-in first
  tokenClient.requestAccessToken({ prompt: '' });

  // Safety fallback in case Google returns nothing
  setTimeout(() => {
    if (!oauthToken) {
      renderSignInButton();
    }
  }, 1000);
};
</script>

</body>
</html>
