<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Matt Command Center</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 1fr);
    height: 100vh;
    gap: 8px;
    padding: 8px;
  }

  .tile {
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
    padding: 10px;
    overflow: hidden;
  }

  .tile:hover {
    background: #222;
  }

  a {
    color: white;
    text-decoration: none;
    width: 100%;
    display: block;
  }

  .personal {
    background: #1a1a2e;
  }

  ul {
    margin: 4px 0 0 0;
    padding-left: 0;
    font-size: 0.9em;
    list-style: none;
    width: 100%;
  }

  li {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 6px;
  }

  input[type="text"] {
    flex: 1;
    padding: 4px 6px;
    font-size: 0.9em;
    border-radius: 4px;
    border: none;
  }

  button {
    padding: 4px 6px;
    font-size: 0.8em;
    margin-left: 6px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
  }

</style>
</head>
<body>

<div class="grid">

  <!-- Work Tiles -->
  <div class="tile">
    <a href="https://outlook.office.com/mail/" target="_blank">Outlook</a>
  </div>

  <div class="tile">
    <a href="https://app.slack.com/" target="_blank">Slack</a>
  </div>

  <div class="tile">
    <a href="https://www.icloud.com/reminders/" target="_blank">Reminders</a>
  </div>

  <!-- Personal Tiles -->
  <div class="tile personal" id="google-tasks-tile" style="align-items:flex-start; justify-content:flex-start; padding:10px;">
    <!-- Header clickable only -->
    <a href="https://tasks.google.com/" target="_blank">
      <h2 style="margin:0; padding:0; line-height:1.2;">Google Tasks</h2>
    </a>

    <!-- Task input and list -->
    <ul id="tasks-list"></ul>
  </div>

  <div class="tile personal">
    <a href="https://chat.openai.com/" target="_blank">ChatGPT</a>
  </div>

  <div class="tile personal">
    <a href="https://publish.obsidian.md/YourVaultName/" target="_blank">Obsidian</a>
  </div>

</div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
const CLIENT_ID = '903590667874-gln8c4dq5m9if43o6879fqofqqh3smiu.apps.googleusercontent.com';
const API_KEY = 'AIzaSyDXZzSgAX-GeS1Hl3tAjT16GTGKCmvJSV0';
const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest';
const SCOPES = 'https://www.googleapis.com/auth/tasks';

let tokenClient;

// 1Ô∏è‚É£ Load GAPI
function gapiLoaded() {
  gapi.load('client', initializeGapiClient);
}

// 2Ô∏è‚É£ Initialize GAPI client
async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: API_KEY,
    discoveryDocs: [DISCOVERY_DOC],
  });

  // Try silent login first
  handleAuth(loadTasks);

  // If no token after 1 sec, show sign-in button
  setTimeout(() => {
    if (!gapi.client.getToken()) {
      const tasksList = document.getElementById("tasks-list");
      tasksList.innerHTML = "";
      const btnLi = document.createElement("li");
      const signInBtn = document.createElement("button");
      signInBtn.innerText = "Sign in to load tasks";
      signInBtn.onclick = () => handleAuth(loadTasks);
      btnLi.appendChild(signInBtn);
      tasksList.appendChild(btnLi);
    }
  }, 1000);
}

// 3Ô∏è‚É£ OAuth login
function handleAuth(callbackAfterAuth = null) {
  tokenClient = google.accounts.oauth2.initTokenClient({
  client_id: CLIENT_ID,
  scope: SCOPES,
  prompt: 'consent', // forces user to pick account first time
  callback: (response) => {
    gapi.client.setToken(response);
    loadTasks();
  }
});
tokenClient.requestAccessToken();
}

// 4Ô∏è‚É£ CRUD functions
function addTask(title) {
  if (!title.trim()) return;
  gapi.client.tasks.tasks.insert({
    tasklist: '@default',
    resource: { title }
  }).then(() => loadTasks())
    .catch(err => console.error('Error adding task:', err));
}

function completeTask(task) {
  gapi.client.tasks.tasks.update({
    tasklist: '@default',
    task: task.id,
    resource: {
      id: task.id,
      title: task.title,
      notes: task.notes || '',
      status: 'completed'
    }
  }).then(() => loadTasks())
    .catch(err => console.error('Error completing task:', err));
}

function deleteTask(taskId) {
  gapi.client.tasks.tasks.delete({
    tasklist: '@default',
    task: taskId
  }).then(() => loadTasks())
    .catch(err => console.error('Error deleting task:', err));
}

// 5Ô∏è‚É£ Load tasks with input, checkboxes, delete
function loadTasks() {
  gapi.client.tasks.tasks.list({
    tasklist: '@default',
    showCompleted: false,
    maxResults: 50
  }).then(response => {
    const tasks = response.result.items || [];
    const tasksList = document.getElementById("tasks-list");
    tasksList.innerHTML = "";

    // Input field for new task
    const inputLi = document.createElement("li");
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "New task‚Ä¶";
    const addBtn = document.createElement("button");
    addBtn.textContent = "Add";
    addBtn.onclick = () => {
      addTask(input.value);
      input.value = "";
    };
    inputLi.appendChild(input);
    inputLi.appendChild(addBtn);
    tasksList.appendChild(inputLi);

    if (tasks.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No active tasks üéâ";
      tasksList.appendChild(li);
      return;
    }

    // Add tasks
    tasks.forEach(task => {
      const li = document.createElement("li");

      // Checkbox
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.style.marginRight = "8px";
      checkbox.onclick = e => { 
        e.stopPropagation(); 
        completeTask(task); 
      };

      // Task title
      const span = document.createElement("span");
      span.textContent = task.title;

      // Delete button
      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.onclick = e => { 
        e.stopPropagation(); 
        if (confirm(`Delete "${task.title}"?`)) deleteTask(task.id); 
      };

      li.appendChild(checkbox);
      li.appendChild(span);
      li.appendChild(delBtn);
      tasksList.appendChild(li);
    });
  });
}

// 6Ô∏è‚É£ Start
gapiLoaded();
</script>

</body>
</html>
