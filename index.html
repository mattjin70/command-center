<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Matt Command Center</title>

<style>
  body {
    margin: 0;
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 1fr);
    height: 100vh;
    gap: 8px;
    padding: 8px;
  }

  .tile {
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
    padding: 12px;
    overflow: hidden;
  }

  .tile:hover {
    background: #222;
  }

  .tile a {
    color: white;
    text-decoration: none;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .personal {
    background: #1a1a2e;
  }

  /* Google Tasks specific layout */
  #google-tasks-tile {
    justify-content: flex-start;
    align-items: stretch;
    text-align: left;
  }

  #google-tasks-tile h2 {
    margin: 0 0 10px 0;
    font-size: 1.2em;
  }

  #tasks-list {
    list-style: none;
    padding: 0;
    margin: 0;
    overflow-y: auto;
    flex: 1;
    font-size: 0.9em;
  }

  #tasks-list li {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }

  #tasks-list input[type="text"] {
    width: 70%;
    padding: 4px;
  }

  #tasks-list button {
    margin-left: 6px;
    padding: 4px 8px;
    cursor: pointer;
  }

</style>
</head>
<body>

<div class="grid">

  <!-- Work Tiles -->
  <div class="tile">
    <a href="https://outlook.office.com/mail/" target="_blank">Outlook</a>
  </div>

  <div class="tile">
    <a href="https://app.slack.com/" target="_blank">Slack</a>
  </div>

  <div class="tile">
    <a href="https://www.icloud.com/reminders/" target="_blank">Reminders</a>
  </div>

  <!-- Google Tasks Tile -->
  <div class="tile personal" id="google-tasks-tile">

    <a href="https://tasks.google.com/" target="_blank" style="display:block; height:auto;">
      <h2>Google Tasks</h2>
    </a>

    <ul id="tasks-list"></ul>

  </div>

  <div class="tile personal">
    <a href="https://chat.openai.com/" target="_blank">ChatGPT</a>
  </div>

  <div class="tile personal">
    <a href="https://publish.obsidian.md/YourVaultName/" target="_blank">Obsidian</a>
  </div>

</div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
const CLIENT_ID = '903590667874-gln8c4dq5m9if43o6879fqofqqh3smiu.apps.googleusercontent.com';
const API_KEY = 'AIzaSyDXZzSgAX-GeS1Hl3tAjT16GTGKCmvJSV0';
const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest';
const SCOPES = 'https://www.googleapis.com/auth/tasks';

let tokenClient;

function gapiLoaded() {
  gapi.load('client', initializeGapiClient);
}

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: API_KEY,
    discoveryDocs: [DISCOVERY_DOC],
  });

  const tasksList = document.getElementById("tasks-list");
  tasksList.innerHTML = "";

  // Try silent auth first
  handleAuth(loadTasks);

  // If silent auth fails, show button
  setTimeout(() => {
    if (!gapi.client.getToken()) {
      const signInBtn = document.createElement("button");
      signInBtn.innerText = "Sign in to load tasks";
      signInBtn.onclick = () => handleAuth(loadTasks);

      const li = document.createElement("li");
      li.appendChild(signInBtn);
      tasksList.appendChild(li);
    }
  }, 1000);
}

function handleAuth(callbackAfterAuth = null) {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    prompt: '', // ðŸ”¥ allows silent refresh if already authorized
    callback: (response) => {
      if (response.error) {
        console.error(response);
        return;
      }

      gapi.client.setToken(response);

      if (callbackAfterAuth) {
        callbackAfterAuth();
      } else {
        loadTasks();
      }
    },
  });

  tokenClient.requestAccessToken();
}

function addTask(title) {
  if (!title.trim()) return;

  gapi.client.tasks.tasks.insert({
    tasklist: '@default',
    resource: { title: title }
  }).then(loadTasks)
    .catch(err => console.error('Error adding task:', err));
}

function completeTask(task) {
  gapi.client.tasks.tasks.update({
    tasklist: '@default',
    task: task.id,
    resource: {
      ...task,
      status: 'completed'
    }
  }).then(loadTasks)
    .catch(err => console.error('Error completing task:', err));
}

function deleteTask(taskId) {
  gapi.client.tasks.tasks.delete({
    tasklist: '@default',
    task: taskId
  }).then(loadTasks)
    .catch(err => console.error('Error deleting task:', err));
}

function loadTasks() {
  gapi.client.tasks.tasks.list({
    tasklist: '@default',
    showCompleted: false,
    maxResults: 20
  }).then(response => {

    const tasks = response.result.items || [];
    const tasksList = document.getElementById("tasks-list");
    tasksList.innerHTML = "";

    // Input row
    const inputLi = document.createElement("li");

    const taskInput = document.createElement("input");
    taskInput.type = "text";
    taskInput.placeholder = "New taskâ€¦";

    const addBtn = document.createElement("button");
    addBtn.innerText = "Add";
    addBtn.onclick = () => {
      addTask(taskInput.value);
      taskInput.value = "";
    };

    inputLi.appendChild(taskInput);
    inputLi.appendChild(addBtn);
    tasksList.appendChild(inputLi);

    if (tasks.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No active tasks ðŸŽ‰";
      tasksList.appendChild(li);
      return;
    }

    tasks.forEach(task => {
      const li = document.createElement("li");

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.style.marginRight = "8px";
      checkbox.onclick = (e) => {
        e.stopPropagation();
        completeTask(task);
      };

      const title = document.createElement("span");
      title.textContent = task.title;

      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.onclick = () => {
        if (confirm(`Delete task "${task.title}"?`)) {
          deleteTask(task.id);
        }
      };

      li.appendChild(checkbox);
      li.appendChild(title);
      li.appendChild(delBtn);
      tasksList.appendChild(li);
    });

  });
}

gapiLoaded();
</script>

</body>
</html>
