<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Matt Command Center</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 1fr);
    height: 100vh;
    gap: 8px;
    padding: 8px;
  }

  .tile {
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
    padding: 10px;
    overflow: hidden;
  }

  .tile:hover {
    background: #222;
  }

  a {
    color: white;
    text-decoration: none;
    width: 100%;
    display: block;
  }

  .personal {
    background: #1a1a2e;
  }

  ul {
    margin: 4px 0 0 0;
    padding-left: 0;
    font-size: 0.9em;
    list-style: none;
    width: 100%;
  }

  li {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 6px;
  }

  input[type="text"] {
    flex: 1;
    padding: 4px 6px;
    font-size: 0.9em;
    border-radius: 4px;
    border: none;
  }

  button {
    padding: 4px 6px;
    font-size: 0.8em;
    margin-left: 6px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
  }

</style>
</head>
<body>

<div class="grid">

  <!-- Work Tiles -->
  <div class="tile">
    <a href="https://outlook.office.com/mail/" target="_blank">Outlook</a>
  </div>

  <div class="tile">
    <a href="https://app.slack.com/" target="_blank">Slack</a>
  </div>

  <div class="tile">
    <a href="https://www.icloud.com/reminders/" target="_blank">Reminders</a>
  </div>

  <!-- Personal Tiles -->
  <div class="tile personal" id="google-tasks-tile" style="align-items:flex-start; justify-content:flex-start; padding:10px;">
    <!-- Header clickable only -->
    <a href="https://tasks.google.com/" target="_blank">
      <h2 style="margin:0; padding:0; line-height:1.2;">Google Tasks</h2>
    </a>

    <!-- Task input and list -->
    <ul id="tasks-list"></ul>
  </div>

  <div class="tile personal">
    <a href="https://chat.openai.com/" target="_blank">ChatGPT</a>
  </div>

  <div class="tile personal">
    <a href="https://publish.obsidian.md/YourVaultName/" target="_blank">Obsidian</a>
  </div>

</div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
const CLIENT_ID = '903590667874-gln8c4dq5m9if43o6879fqofqqh3smiu.apps.googleusercontent.com';
const API_KEY = 'AIzaSyDXZzSgAX-GeS1Hl3tAjT16GTGKCmvJSV0';
const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest';
const SCOPES = 'https://www.googleapis.com/auth/tasks';

let tokenClient;

// Wait for window to fully load
window.onload = function () {
  gapi.load('client', initializeGapiClient);
};

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: API_KEY,
    discoveryDocs: [DISCOVERY_DOC],
  });

  renderSignInButton();
}

function renderSignInButton() {
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML = '';

  const btn = document.createElement('button');
  btn.textContent = 'Sign in to load tasks';
  btn.onclick = handleAuth;

  tasksList.appendChild(btn);
}

function handleAuth() {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    prompt: 'consent',
    callback: async (resp) => {
      gapi.client.setToken(resp);
      loadTasks();
    }
  });

  tokenClient.requestAccessToken();
}

async function loadTasks() {
  const response = await gapi.client.tasks.tasks.list({
    tasklist: '@default',
    showCompleted: false,
    maxResults: 20
  });

  const tasks = response.result.items || [];
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML = '';

  const inputLi = document.createElement('li');
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'New task...';

  const addBtn = document.createElement('button');
  addBtn.textContent = 'Add';
  addBtn.onclick = async () => {
    if (!input.value.trim()) return;

    await gapi.client.tasks.tasks.insert({
      tasklist: '@default',
      resource: { title: input.value }
    });

    input.value = '';
    loadTasks();
  };

  inputLi.appendChild(input);
  inputLi.appendChild(addBtn);
  tasksList.appendChild(inputLi);

  tasks.forEach(task => {
    const li = document.createElement('li');

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.onclick = async () => {
      await gapi.client.tasks.tasks.update({
        tasklist: '@default',
        task: task.id,
        resource: {
          id: task.id,
          title: task.title,
          status: 'completed'
        }
      });
      loadTasks();
    };

    const span = document.createElement('span');
    span.textContent = task.title;
    span.style.marginLeft = '8px';

    const delBtn = document.createElement('button');
    delBtn.textContent = 'Delete';
    delBtn.onclick = async () => {
      await gapi.client.tasks.tasks.delete({
        tasklist: '@default',
        task: task.id
      });
      loadTasks();
    };

    li.appendChild(checkbox);
    li.appendChild(span);
    li.appendChild(delBtn);
    tasksList.appendChild(li);
  });
}
</script>

</body>
</html>
